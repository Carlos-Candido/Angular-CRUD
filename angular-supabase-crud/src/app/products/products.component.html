<div class="products-container card">
  <div
    class="products-header"
    style="
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 16px;
    "
  >
    <div style="display: flex; align-items: center; gap: 16px">
      <button
        mat-icon-button
        routerLink="/"
        class="back-button"
        matTooltip="Voltar para Home"
      >
        <mat-icon>arrow_back</mat-icon>
      </button>
      <div>
        <h2 style="margin: 0">Lista de Produtos</h2>
        <div class="muted" style="font-size: 13px">
          Total: {{ products().length }} produtos
        </div>
      </div>
    </div>

    <div style="display: flex; gap: 12px; align-items: center">
      <button
        mat-icon-button
        routerLink="/cart"
        class="cart-button"
        [matBadge]="cartItemCount()"
        [matBadgeHidden]="cartItemCount() === 0"
        matBadgeColor="warn"
        matTooltip="Ver Carrinho"
      >
        <mat-icon>shopping_cart</mat-icon>
      </button>
      <button mat-stroked-button (click)="onLogout()" class="logout-button">
        <mat-icon>logout</mat-icon>
        Sair
      </button>
    </div>
  </div>

  <div class="table-wrap">
    <table
      mat-table
      [dataSource]="products()"
      class="mat-elevation-z8 full-width"
    >
      <!-- Imagem -->
      <ng-container matColumnDef="image">
        <th mat-header-cell *matHeaderCellDef>Imagem</th>
        <td mat-cell *matCellDef="let product">
          <img
            [src]="
              product.imageUrl ||
              'https://via.placeholder.com/60?text=Sem+Imagem'
            "
            alt="{{ product.name }}"
            class="product-image"
            (error)="onImageError($event)"
          />
        </td>
      </ng-container>

      <!-- Nome -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Nome</th>
        <td mat-cell *matCellDef="let product">{{ product.name }}</td>
      </ng-container>

      <!-- Descrição -->
      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef>Descrição</th>
        <td mat-cell *matCellDef="let product" class="description-cell">
          {{ product.description || "-" }}
        </td>
      </ng-container>

      <!-- Preço -->
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef>Preço</th>
        <td mat-cell *matCellDef="let product">
          {{ product.price | currency : "BRL" }}
        </td>
      </ng-container>

      <!-- Ações -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Ações</th>
        <td mat-cell *matCellDef="let product">
          <button
            mat-icon-button
            color="primary"
            (click)="openDialog(product)"
            matTooltip="Editar"
          >
            <mat-icon>edit</mat-icon>
          </button>
          <button
            mat-icon-button
            color="warn"
            (click)="deleteProduct(product.id!)"
            matTooltip="Excluir"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <!-- Carrinho -->
      <ng-container matColumnDef="cart">
        <th mat-header-cell *matHeaderCellDef>Carrinho</th>
        <td mat-cell *matCellDef="let product">
          <button
            mat-raised-button
            color="accent"
            (click)="addToCart(product)"
            style="font-size: 12px"
          >
            <mat-icon style="font-size: 18px; width: 18px; height: 18px"
              >shopping_cart</mat-icon
            >
            Adicionar
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <div *ngIf="products().length === 0" class="empty-state">
      Nenhum produto encontrado. Clique em "Adicionar Produto" para começar.
    </div>
  </div>

  <div style="display: flex; justify-content: flex-end; margin-top: 18px">
    <button
      mat-raised-button
      color="primary"
      (click)="openDialog()"
      class="add-button"
    >
      <mat-icon>add</mat-icon>
      Adicionar Produto
    </button>
  </div>
</div>
